// Automatic Table Of Contents 1.8.0 (https://github.com/johansatge)
"use strict";var v=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var U=(i,e)=>{for(var t in e)v(i,t,{get:e[t],enumerable:!0})},G=(i,e,t,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of j(e))!V.call(i,n)&&n!==t&&v(i,n,{get:()=>e[n],enumerable:!(l=R(e,n))||l.enumerable});return i};var z=i=>G(v({},"__esModule",{value:!0}),i);var ae={};U(ae,{default:()=>se});module.exports=z(ae);var y=class{},g={},L=class{},T=class{},B=class{},C=class{},O=i=>i;if(q())try{let i=require("obsidian");y=i.Plugin,g=i.MarkdownRenderer,L=i.MarkdownRenderChild,T=i.PluginSettingTab,B=i.Setting,C=i.SettingGroup||class{},O=i.htmlToMarkdown}catch{}function q(){return typeof process!="object"?!0:!process.env||!process.env.JEST_WORKER_ID}function k(i,e){return e.include?e.include.test(i):e.exclude?!e.exclude.test(i):!0}function p(i,e){if(e.includeLinks){let t=i;t=F(t),t=K(t),t=P(t,!1);let l=i;return l=P(l,!0),l=J(l),`[[#${l}|${t}]]`}return i}function F(i){return i.replaceAll("*","").replaceAll(/(\W|^)_+(\S)(.*?\S)?_+(\W|$)/g,"$1$2$3$4").replaceAll("`","").replaceAll("==","").replaceAll("~~","").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")}function K(i){return F(O(i))}function P(i,e){return i.replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,e?"$1 $2":"$2").replace(/\[\[([^\]]+)\]\]/g,"$1").replaceAll("[[","").replaceAll("| ",e?"":"- ").replaceAll("|",e?" ":"-")}function J(i){return i.replaceAll("#"," ")}function I(i,e){let t={nestedList:Z,nestedOrderedList:Q,inlineFirstLevel:Y},l="";if(e.title&&e.title.length>0){let a=e.style==="inlineFirstLevel"?" ":`
`;l+=`${e.title}${a}`}let n=t[e.style](i,e);return n===null?e.hideWhenEmpty?"":`${l}_Table of contents: no headings found_`:l+n}function Z(i,e){return N(i,!1,e)}function Q(i,e){return N(i,!0,e)}function w(i,e){let t=e.minLevel>0?e.minLevel:Math.min(...i.map(s=>s.level)),l=[],n=0;for(let s of i)if(!(n>0&&s.level>n)){if(s.level<=n&&(n=0),!k(s.heading,e)){e.exclude&&(n=s.level);continue}s.level<t||e.maxLevel>0&&s.level>e.maxLevel||s.heading.length!==0&&l.push(s)}let a=X(l);return l.map((s,r)=>({heading:s,depth:a[r]}))}function N(i,e,t){let l=e?"1.":"-",a=w(i,t).map(({heading:s,depth:r})=>`${"	".repeat(r)}${l} ${p(s.heading,t)}`);return a.length>0?a.join(`
`):null}function X(i){let e=[],t=[];for(let l of i){for(;t.length>0&&t[t.length-1]>=l.level;)t.pop();t.push(l.level),e.push(t.length-1)}return e}function Y(i,e){let t=e.minLevel>0?e.minLevel:Math.min(...i.map(n=>n.level)),l=i.filter(n=>n.level===t).filter(n=>n.heading.length>0).filter(n=>k(n.heading,e)).map(n=>p(n.heading,e));return l.length>0?l.join(" | "):null}var o={title:"",style:"nestedList",minLevel:0,maxLevel:0,include:null,exclude:null,includeLinks:!0,hideWhenEmpty:!1,foldable:!1,debugInConsole:!1};var x={title:{type:"string",default:o.title,comment:""},style:{type:"value",default:o.style,values:["nestedList","nestedOrderedList","inlineFirstLevel"],comment:"TOC style (nestedList|nestedOrderedList|inlineFirstLevel)"},minLevel:{type:"number",default:o.minLevel,comment:"Include headings from the specified level"},maxLevel:{type:"number",default:o.maxLevel,comment:"Include headings up to the specified level"},include:{type:"regexp",default:null,comment:""},exclude:{type:"regexp",default:null,comment:""},includeLinks:{type:"boolean",default:o.includeLinks,comment:"Make headings clickable"},hideWhenEmpty:{type:"boolean",default:o.hideWhenEmpty,comment:"Hide TOC if no headings are found"},foldable:{type:"boolean",default:o.foldable,comment:"Make TOC sections collapsible"},debugInConsole:{type:"boolean",default:!1,comment:"Print debug info in Obsidian console"}};function A(){let i=[];for(let e of Object.keys(x)){let t=x[e],l=t.comment.length>0?` # ${t.comment}`:"",n=t.default!==null?t.default:"";i.push(`${e}: ${n}${l}`)}return i.join(`
`)}function $(i="",e=null){let t={title:o.title,style:o.style,minLevel:o.minLevel,maxLevel:o.maxLevel,include:o.include,exclude:o.exclude,includeLinks:o.includeLinks,hideWhenEmpty:o.hideWhenEmpty,foldable:o.foldable,debugInConsole:o.debugInConsole};e&&(t.title=e.defaultTitle,t.style=e.defaultStyle,t.minLevel=e.defaultMinLevel,t.maxLevel=e.defaultMaxLevel,t.includeLinks=e.defaultIncludeLinks,t.hideWhenEmpty=e.defaultHideWhenEmpty);for(let l of i.split(`
`)){let n=ee(l);n!==null&&(t[n.name]=n.value)}return t}function ee(i){let e=i.match(/([a-zA-Z0-9._ ]+):(.*)/);if(i.startsWith("#")||!e||!e[1]||!e[2])return null;let t=e[1].trim(),l=x[t],n=e[2].trim();(!l||!["string","regexp"].includes(l.type))&&(n=n.replace(/#[^#]*$/,"").trim());let a=new Error(`Invalid value for \`${t}\``);if(l&&l.type==="number"){let s=Number.parseInt(n,10);if(s<0)throw a;return{name:t,value:s}}if(l&&l.type==="boolean"){if(!["true","false"].includes(n))throw a;return{name:t,value:n==="true"}}if(l&&l.type==="value"){if(l.values&&!l.values.includes(n))throw a;return{name:t,value:n}}if(l&&l.type==="string")return n==="null"||n==='""'||n==="''"?{name:t,value:""}:{name:t,value:n};if(l&&l.type==="regexp"){if(n==="null"||n.length===0)return null;try{let s=/^\/(.*)\/([a-z]*)/.exec(n);if(!s||!s[1])throw new Error("Invalid regexp");let r=new RegExp(s[1],s[2]??"");return{name:t,value:r}}catch{throw a}}return null}var D={defaultTitle:o.title,defaultStyle:o.style,defaultMinLevel:o.minLevel,defaultMaxLevel:o.maxLevel,defaultIncludeLinks:o.includeLinks,defaultHideWhenEmpty:o.hideWhenEmpty},b=class extends T{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=document.createDocumentFragment();t.createDiv({cls:"setting-item-name",text:"Default options"}),t.createDiv({cls:"setting-item-description",text:"Configure default options. They can be overridden per codeblock when inserting the table of contents in a page."}),new C(e).setHeading(t).addSetting(l=>l.setName("Title").setDesc("Title to display before the table of contents (supports Markdown). Use empty string for no title.").addText(n=>n.setPlaceholder("").setValue(this.plugin.settings.defaultTitle).onChange(async a=>{this.plugin.settings.defaultTitle=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Style").setDesc("Table of contents style").addDropdown(n=>n.addOption("nestedList","Nested List").addOption("nestedOrderedList","Nested Ordered List").addOption("inlineFirstLevel","Inline First Level").setValue(this.plugin.settings.defaultStyle).onChange(async a=>{this.plugin.settings.defaultStyle=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Minimum level").setDesc("Include headings from the specified level (0 for no limit)").addText(n=>n.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMinLevel)).onChange(async a=>{let s=Number.parseInt(a,10);!Number.isNaN(s)&&s>=0?(this.plugin.settings.defaultMinLevel=s,await this.plugin.saveSettings()):n.setValue(String(this.plugin.settings.defaultMinLevel))}))).addSetting(l=>l.setName("Maximum level").setDesc("Include headings up to the specified level (0 for no limit)").addText(n=>n.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMaxLevel)).onChange(async a=>{let s=Number.parseInt(a,10);!Number.isNaN(s)&&s>=0?(this.plugin.settings.defaultMaxLevel=s,await this.plugin.saveSettings()):n.setValue(String(this.plugin.settings.defaultMaxLevel))}))).addSetting(l=>l.setName("Include links").setDesc("Make headings clickable").addToggle(n=>n.setValue(this.plugin.settings.defaultIncludeLinks).onChange(async a=>{this.plugin.settings.defaultIncludeLinks=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Hide when empty").setDesc("Hide TOC if no headings are found").addToggle(n=>n.setValue(this.plugin.settings.defaultHideWhenEmpty).onChange(async a=>{this.plugin.settings.defaultHideWhenEmpty=a,await this.plugin.saveSettings()})))}};var E="table-of-contents",te="toc",S=class extends y{async onload(){await this.loadSettings();let e=(t,l,n)=>{n.addChild(new M(this.app,l,n.sourcePath,t,this.settings))};this.registerMarkdownCodeBlockProcessor(E,e),this.registerMarkdownCodeBlockProcessor(te,e),this.addCommand({id:"insert-automatic-table-of-contents",name:"Insert table of contents",editorCallback:ne}),this.addCommand({id:"insert-automatic-table-of-contents-docs",name:"Insert table of contents (with available options)",editorCallback:ie}),this.addSettingTab(new b(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},D,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};function ne(i,e){let t=`\`\`\`${E}
\`\`\``;i.replaceRange(t,i.getCursor())}function ie(i,e){let t=[`\`\`\`${E}
${A()}
\`\`\``];i.replaceRange(t.join(`
`),i.getCursor())}var M=class extends L{constructor(e,t,l,n,a){super(t),this.app=e,this.element=t,this.sourcePath=l,this.sourceText=n,this.pluginSettings=a}onload(){this.render(),this.registerEvent(this.app.metadataCache.on("changed",e=>{e.path===this.sourcePath&&this.onMetadataChange()})),this.registerEvent(this.app.vault.on("rename",(e,t)=>{t===this.sourcePath&&(this.sourcePath=e.path,this.render())}))}onMetadataChange(){this.render()}render(){try{let e=$(this.sourceText,this.pluginSettings);e.debugInConsole&&m("Options",e);let t=this.app.metadataCache.getCache(this.sourcePath),l=t?.headings?t.headings:[];if(e.debugInConsole&&m("Headings",l),this.element.empty(),this.element.classList.add("automatic-toc"),e.foldable&&e.style!=="inlineFirstLevel"){let n=w(l,e);if(e.debugInConsole&&m("Filtered headings",n),n.length===0){if(e.hideWhenEmpty)return;let s=document.createElement("em");if(s.textContent="Table of contents: no headings found",e.title){let r=document.createElement("div");g.renderMarkdown(e.title,r,this.sourcePath,this),this.element.appendChild(r)}this.element.appendChild(s);return}if(e.title){let s=document.createElement("div");g.renderMarkdown(e.title,s,this.sourcePath,this),this.element.appendChild(s)}let a=e.style==="nestedOrderedList";le(this.element,n,e,a)}else{let n=I(l,e);e.debugInConsole&&m("Markdown",n),g.renderMarkdown(n,this.element,this.sourcePath,this)}}catch(e){m("Error",e);let l=`_\u{1F4A5} Could not render table of contents (${e instanceof Error?e.message:String(e)})_`;g.renderMarkdown(l,this.element,this.sourcePath,this)}}};function le(i,e,t,l){function n(r){let h=[],d=[];for(let u of r){let c={text:p(u.heading.heading,t),children:[]};for(;d.length>0&&d[d.length-1].depth>=u.depth;)d.pop();d.length===0?h.push(c):d[d.length-1].node.children.push(c),d.push({node:c,depth:u.depth})}return h}function a(r,h){let d=document.createElement(l?"ol":"ul");for(let u of h){let f=document.createElement("li");if(u.children.length>0){let c=document.createElement("details");c.setAttribute("open","");let H=document.createElement("summary");H.innerHTML=W(u.text),c.appendChild(H),a(c,u.children),f.appendChild(c)}else f.innerHTML=W(u.text);d.appendChild(f)}r.appendChild(d)}let s=n(e);a(i,s)}function W(i){return i.replace(/\[\[#([^\]|]+)\|([^\]]+)\]\]/g,(e,t,l)=>`<a class="internal-link" data-href="#${_(t)}">${_(l)}</a>`)}function _(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;")}function m(i,e){console.log(`%cAutomatic Table Of Contents %c${i}:
`,"color: orange; font-weight: bold","font-weight: bold",e)}var se=S;
